---
import { excludedWords } from "../utils";

const { videos, shorts } = Astro.props;

function normalizeAccents(str: string) {
  // Preservar la ñ antes de normalizar
  return str
    .replace(/ñ/g, "\u0001")
    .normalize("NFD")
    .replace(/[\u0300-\u036f]/g, "")
    .replace(/\u0001/g, "ñ");
}

function wordFreq(items) {
  const s = items
    .map((v) => v.title)
    .join(" ")
    .toLowerCase()
    .replace(/[^\w\sáéíóúñ]/g, " ");

  const normalizedExcluded = excludedWords.map((w) => normalizeAccents(w));

  const words = s
    .split(/\s+/)
    .map((w) => normalizeAccents(w))
    .filter((w) => w.length > 3 && !normalizedExcluded.includes(w));
  const m = {};
  for (const w of words) m[w] = (m[w] || 0) + 1;
  return Object.entries(m)
    .sort((a, b) => b[1] - a[1])
    .slice(0, 50)
    .map((x) => ({ word: x[0], freq: x[1] }));
}
const topWords = wordFreq([...videos, ...shorts]);
---

<section id="curiosidades">
  <div class="container">
    <h2>Curiosidades</h2>

    <div>
      <h3 class="font-semibold mb-2">
        Palabras más frecuentes en los nombres de los vídeos
      </h3>
      <div class="flex gap-2 flex-wrap">
        {
          topWords.map((item) => (
            <span class="px-3 py-1 border rounded-full text-sm">
              {item.word} <span class="text-xs opacity-75">({item.freq})</span>
            </span>
          ))
        }
      </div>
    </div>
  </div>
</section>

<style>
  #curiosidades {
    padding-block: 3em;
    background: #ffc0ea;
    min-height: 100vh;
    display: grid;
    align-items: start;
    justify-content: center;
  }
</style>
