---
import { formatNum } from "../utils";

import Layout from "../layouts/Layout.astro";
import Intro from "../components/intro.astro";
import Cover from "../components/cover.astro";
import Stats from "../components/stats.astro";
import Videos from "../components/videos.astro";
import Shorts from "../components/shorts.astro";
import TimeLineList from "../components/timeline/timelineList.astro";
import Curiosidades from "../components/curiosidades.astro";
import Messages from "../components/Messages.astro";
import Despedida from "../components/despedida.astro";
import Footer from "../layouts/components/Footer.astro";
import Aniversarios from "../components/aniversarios.astro";
import Placa from "../components/placa.astro";

import channel from "../data/channel.json";
import videos from "../data/videos.json"; // si es array total o solo largos
import shorts from "../data/shorts.json";
---

<Layout>
  <main>
    <Intro />

    <!-- Contenido -->
    <div
      id="main-content"
      style="display: none; opacity: 0;"
      class="opacity-0 transition-opacity duration-1000"
    >
      <!-- Portada -->
      <Cover />

      <!-- Stats -->
      <Stats channel={channel} videos={videos} shorts={shorts} />

      <!-- Insights -->
      <TimeLineList />

      <Aniversarios />

      <!-- Top Videos -->
      <Videos videos={videos} />

      <!-- Top Shorts -->
      <Shorts shorts={shorts} />

      <!-- Insights -->
      <Curiosidades videos={videos} shorts={shorts} />

      <Messages />

      <Placa />

      <Despedida />

      <Footer />
    </div>
  </main>

  <script>
    // Descargar póster de la portada/cover (ejemplo)
    document
      .getElementById("downloadCover")
      .addEventListener("click", async () => {
        const node = document.getElementById("cover");
        const canvas = await html2canvas(node, {
          scale: 2,
          backgroundColor: null,
        });
        const url = canvas.toDataURL("image/png");
        const a = document.createElement("a");
        a.href = url;
        a.download = "umaruyt-wrapped.png";
        a.click();
      });

    // Ejemplo simple de compartir a X (Twitter)
    document.getElementById("shareX").addEventListener("click", () => {
      const text = encodeURIComponent(
        `UmaruYT Wrapped — mis videos favoritos: ${topVideosTitles()}`
      );
      const url = encodeURIComponent(location.href);
      window.open(
        `https://twitter.com/intent/tweet?text=${text}&url=${url}`,
        "_blank"
      );
    });

    function topVideosTitles() {
      return Array.from(document.querySelectorAll("#top-videos a p"))
        .slice(0, 3)
        .map((p) => p.textContent.trim())
        .join(", ");
    }
  </script>
</Layout>

<style is:global>
  h2 {
    font-size: 2rem;
    font-weight: bold;
    text-align: left;
    margin-bottom: 2rem;
  }
  h3 {
    font-size: 1.5em;
  }
  /* section {
    min-height: 100vh;
    padding: 1em auto;
  } */
  .container {
    width: min(1200px, 95%);
    margin: 0 auto;
    max-width: 100%;
    overflow: hidden;
  }

  #main-content > section:nth-child(3n + 1) {
    background: #a8ede8;
  }

  #main-content > section:nth-child(3n + 2) {
    background: #c3c0ff;
  }

  #main-content > section:nth-child(3n + 3) {
    background: #ffc0ea;
  }
</style>
